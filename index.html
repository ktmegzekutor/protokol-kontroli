<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protokół Kontroli Obiektu Budowlanego</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="print-panel">
        <button onclick="window.print()">Drukuj protokół</button>
        <button onclick="saveProtocol()">Zapisz protokół</button>
        <button onclick="loadProtocol()">Wczytaj protokół</button>
        <button onclick="exportToJson()">Eksportuj do JSON</button>
        <input type="file" id="import-json" class="no-print" accept=".json" onchange="importFromJson(event)" style="display:none;">
        <button onclick="document.getElementById('import-json').click()">Importuj z JSON</button>
        <button onclick="clearForm()">Wyczyść formularz</button>
    </div>

    <form id="protocolForm">
        <div class="page-header">S t r o n a | 1</div>

        <div class="header">
            <h1>PROTOKÓŁ NR: <input type="text" name="protocol_number" id="protocol_number" list="protocol_numbers" placeholder="24/2024" value="24/2024"> z dnia <input type="date" name="protocol_date" id="protocol_date" value="2024-11-15"></h1>
            <datalist id="protocol_numbers"></datalist>
        </div>

        <p>z okresowej kontroli obiektu budowlanego obejmującej:</p>
        <ul>
            <li>sprawdzenie stanu technicznego elementów budynku, budowli i instalacji narażonych na szkodliwe wpływy atmosferyczne i niszczące działania czynników występujących podczas użytkowania obiektu</li>
            <li>sprawdzenie stanu technicznego instalacji i urządzeń służących ochronie środowiska</li>
            <li>sprawdzenie stanu technicznego instalacji gazowych oraz przewodów kominowych (dymowych, spalinowych i wentylacyjnych)</li>
        </ul>

        <h2>BRANŻA OGÓLNOBUDOWLANA</h2>
        <h3>KONTROLA OKRESOWA – CO NAJMINIEJ RAZ W ROKU</h3>
        <h4>PODSTAWA PRAWNA</h4>
        <p>Podstawa prawna: art. 62 ust.1 pkt 1 ustawy z dnia 7 lipca 1994 roku – Prawo budowlane</p>

        <table>
            <tr>
                <td>Adres obiektu budowlanego:</td>
                <td><input type="text" name="address" id="address" list="addresses" value="Lubliniec, ul. Oleska nr 18, 42-700 Lubliniec"></td>
                <td rowspan="9">ZDJĘCIE OBIEKTU<br><input type="file" accept="image/*" id="building_image" class="no-print"></td>
            </tr>
            <tr>
                <td>Numer ewidencyjny obiektu</td>
                <td><input type="text" name="ev_number" id="ev_number" list="ev_numbers" value="240701_1.0002.AR_4.2414/27"></td>
            </tr>
            <tr>
                <td>Nazwa obiektu/funkcja:</td>
                <td><input type="text" name="building_name" id="building_name" list="building_names" value="Budynek produkcyjno-magazynowy z częścią socjalno-biurową"></td>
            </tr>
            <tr>
                <td>Data bieżącej kontroli:</td>
                <td><input type="date" name="current_control_date" id="current_control_date" value="2024-11-15"></td>
            </tr>
            <tr>
                <td>Data kolejnej kontroli:</td>
                <td><input type="date" name="next_control_date" id="next_control_date" value="2025-05-15"></td>
            </tr>
            <tr>
                <td>Właściciel obiektu:</td>
                <td><input type="text" name="owner" id="owner" list="owners" value="EXPAC Sp. z o.o."></td>
            </tr>
            <tr>
                <td>Zarządca obiektu budowlanego:</td>
                <td><input type="text" name="manager" id="manager" list="managers" value="EXPAC Sp. z o.o."></td>
            </tr>
            <tr>
                <td>Wykonawca KONTROLI:</td>
                <td><input type="text" name="inspector" id="inspector" list="inspectors" value="Tomasz Kordek, posiadający uprawnienia w zakresie konstrukcyjno-budowlanym"></td>
            </tr>
            <tr>
                <td>Przy udziale:</td>
                <td><input type="text" name="participant" id="participant" list="participants" value="Agnieszka Jeneralczuk - przedstawiciel właściciela"></td>
            </tr>
        </table>
        
        <!-- Datalisty do podpowiadania -->
        <datalist id="addresses"></datalist>
        <datalist id="ev_numbers"></datalist>
        <datalist id="building_names"></datalist>
        <datalist id="owners"></datalist>
        <datalist id="managers"></datalist>
        <datalist id="inspectors"></datalist>
        <datalist id="participants"></datalist>
    </form>

    <script src="script.js"></script>
</body>
</html>
        <hr>
        <div class="page-header page-break">S t r o n a | 2</div>

        <h2>PODSTAWOWE DANE OBIEKTU BUDOWLANEGO</h2>

        <table>
            <tr>
                <td>Rodzaj konstrukcji</td>
                <td><input type="checkbox" name="construction_steel" id="construction_steel" checked> stalowa</td>
                <td><input type="checkbox" name="construction_brick" id="construction_brick"> murowana</td>
                <td><input type="checkbox" name="construction_wood" id="construction_wood"> drewniana</td>
                <td><input type="checkbox" name="construction_reinforced" id="construction_reinforced"> żelbetowa</td>
                <td><input type="checkbox" name="construction_mixed" id="construction_mixed"> mieszana</td>
                <td><input type="checkbox" name="construction_other" id="construction_other"> inna: <input type="text" name="construction_other_desc" id="construction_other_desc" style="width: 60%;"></td>
            </tr>
        </table>

        <table>
            <tr>
                <td style="width: 50%;">Wyposażenie budynku (zakreślić kwadrat)</td>
                <td style="width: 50%;"></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_vent_grav" id="eq_vent_grav" checked> przewody dymowe, spalinowe, wentylacyjne - grawitacyjne</td>
                <td></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_vent_mech" id="eq_vent_mech"> przewody wentylacyjne - wentylacja mechaniczna</td>
                <td></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_gas" id="eq_gas"> instalacja gazowa</td>
                <td></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_water" id="eq_water" checked> instalacja wodno-kanalizacyjna</td>
                <td></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_electrical" id="eq_electrical" checked> instalacje elektryczne</td>
                <td></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_heating" id="eq_heating" checked> instalacje ogrzewania</td>
                <td></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_env" id="eq_env"> instalacje i urządzenia służące ochronie środowiska</td>
                <td></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_solar" id="eq_solar"> instalacje fotowoltaiczna</td>
                <td></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_tech" id="eq_tech" checked> instalacje teletechniczna</td>
                <td></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_flood" id="eq_flood"> instalacje przeciwpowodziowa</td>
                <td></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_lift" id="eq_lift"> dźwig osobowy/winda</td>
                <td></td>
            </tr>
            <tr>
                <td><input type="checkbox" name="eq_other" id="eq_other"> inne</td>
                <td></td>
            </tr>
        </table>
        <hr>
        <div class="page-header page-break">S t r o n a | 3</div>

        <h3>Właściciel (Zarządca) nieruchomości przedstawił do wglądu następujące protokoły:</h3>

        <table>
            <tr>
                <td>Przeglądu kominiarskiego z dnia:</td>
                <td><input type="text" name="chimney_inspection_date" id="chimney_inspection_date" value="22.06.2024"></td>
                <td><input type="text" name="chimney_inspection_status" id="chimney_inspection_status" placeholder="czy są i czy są ważne / czy okazano"></td>
            </tr>
            <tr>
                <td>Przeglądu wentylacji mechanicznej z dnia:</td>
                <td><input type="text" name="ventilation_inspection_date" id="ventilation_inspection_date" value="Nie dotyczy"></td>
                <td><input type="text" name="ventilation_inspection_status" id="ventilation_inspection_status" placeholder="czy są i czy są ważne / czy okazano"></td>
            </tr>
            <tr>
                <td>Inne:</td>
                <td colspan="2"><input type="text" name="other_inspections" id="other_inspections" value="Protokół z poprzedniej kontroli półrocznej z dnia 14.05.2024"></td>
            </tr>
        </table>

        <div class="section-header">IV. ZALECENIA</div>
        
        <textarea name="recommendations" id="recommendations" rows="5">Zaleca się regularną kontrolę i konserwację systemu odwodnienia dachu przed sezonem jesienno-zimowym.</textarea>
        
        <div class="section-header">2. OKREŚLENIE ZAKRESU ROBÓT REMONTOWYCH I KOLEJNOŚCI ICH WYKONYWANIA:</div>
        
        <table id="repairs-table">
            <tr>
                <th>Zakres czynności</th>
                <th>Termin wykonania</th>
            </tr>
            <tr>
                <td><input type="text" name="repair_scope_1" id="repair_scope_1" value="Czyszczenie rynien i rur spustowych"></td>
                <td><input type="text" name="repair_deadline_1" id="repair_deadline_1" value="Przed sezonem jesienno-zimowym (do 30.09.2025)"></td>
            </tr>
        </table>
        <button type="button" class="no-print" onclick="addRepairRow()">+ Dodaj zakres czynności</button>
        
        <div class="signature">
            <p>Oświadczamy, iż ustalenia zawarte w protokole są zgodne ze stanem faktycznym.</p>
            <p>dokonujący kontroli okresowej stanu technicznego:<br>
            elementów obiektu budowlanego/ budowlanego</p>
            <p>..........................................................................<br>
            imię i nazwisko oraz nr uprawnień, specjalność (podpis)</p>
        </div>
body {
    font-family: Arial, sans-serif;
    line-height: 1.5;
    margin: 20px;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

h1, h2, h3 {
    text-align: center;
}

.page-header {
    text-align: right;
    margin-bottom: 10px;
    font-style: italic;
}

.header {
    margin-bottom: 20px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

table, th, td {
    border: 1px solid #000;
}

th, td {
    padding: 8px;
    text-align: left;
    vertical-align: top;
}

input[type="text"], textarea, select {
    width: 100%;
    padding: 5px;
    border: 1px solid #ddd;
    border-radius: 3px;
}

input[type="checkbox"] {
    margin-right: 5px;
}

textarea {
    min-height: 60px;
}

.section {
    margin-top: 20px;
    margin-bottom: 20px;
}

.section-header {
    background-color: #f0f0f0;
    padding: 5px;
    margin-top: 15px;
    font-weight: bold;
}

.signature {
    margin-top: 30px;
    text-align: center;
}

hr {
    margin: 20px 0;
}

button {
    padding: 10px 15px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    margin: 5px;
}

button:hover {
    background-color: #45a049;
}

#print-panel {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    z-index: 1000;
}

@media print {
    body {
        margin: 0;
        padding: 0;
    }
    
    #print-panel, .no-print {
        display: none;
    }
    
    input, textarea, select {
        border: none;
        background: transparent;
    }
    
    .page-break {
        page-break-before: always;
    }
}
// Lista pól tekstowych do zapamiętywania historii
const fieldsToTrack = [
    'protocol_number', 'address', 'ev_number', 'building_name', 
    'owner', 'manager', 'inspector', 'participant'
];

// Funkcja dodająca wiersz do tabeli zaleceń
function addRecommendationRow() {
    const table = document.getElementById('recommendations-table');
    const rowCount = table.rows.length;
    const row = table.insertRow(-1);
    
    const cell1 = row.insertCell(0);
    const cell2 = row.insertCell(1);
    const cell3 = row.insertCell(2);
    
    cell1.innerHTML = rowCount;
    cell2.innerHTML = `<input type="text" name="prev_recommendation_${rowCount}" id="prev_recommendation_${rowCount}">`;
    cell3.innerHTML = `<input type="text" name="prev_recommendation_status_${rowCount}" id="prev_recommendation_status_${rowCount}">`;
}

// Funkcja dodająca wiersz do tabeli elementów awaryjnych
function addEmergencyRow() {
    const table = document.getElementById('emergency-table');
    const rowCount = table.rows.length;
    const row = table.insertRow(-1);
    
    const cell1 = row.insertCell(0);
    const cell2 = row.insertCell(1);
    const cell3 = row.insertCell(2);
    
    cell1.innerHTML = rowCount;
    cell2.innerHTML = `<input type="text" name="emergency_element_${rowCount}" id="emergency_element_${rowCount}">`;
    cell3.innerHTML = `<input type="text" name="emergency_repair_${rowCount}" id="emergency_repair_${rowCount}">`;
}

// Funkcja dodająca wiersz do tabeli robót remontowych
function addRepairRow() {
    const table = document.getElementById('repairs-table');
    const rowCount = table.rows.length;
    const row = table.insertRow(-1);
    
    const cell1 = row.insertCell(0);
    const cell2 = row.insertCell(1);
    
    cell1.innerHTML = `<input type="text" name="repair_scope_${rowCount}" id="repair_scope_${rowCount}">`;
    cell2.innerHTML = `<input type="text" name="repair_deadline_${rowCount}" id="repair_deadline_${rowCount}">`;
}
// Zapisanie protokołu do pamięci lokalnej
function saveProtocol() {
    const form = document.getElementById('protocolForm');
    const formData = new FormData(form);
    const data = {};
    
    // Pobieranie wartości pól z formularza
    for (const [key, value] of formData.entries()) {
        data[key] = value;
    }
    
    // Pobieranie wartości checkboxów (nie są automatycznie dodawane przez FormData)
    const checkboxes = form.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
        data[checkbox.name] = checkbox.checked;
    });
    
    // Zapisanie całego formularza
    localStorage.setItem('protocolData', JSON.stringify(data));
    
    // Aktualizacja historii dla śledzonych pól
    fieldsToTrack.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && field.value) {
            // Pobranie istniejącej historii lub utworzenie nowej
            let history = JSON.parse(localStorage.getItem(`${fieldId}_history`)) || [];
            
            // Sprawdzenie czy wartość już istnieje
            if (!history.includes(field.value)) {
                history.push(field.value);
                // Zachowanie tylko ostatnich 10 wartości
                if (history.length > 10) {
                    history = history.slice(-10);
                }
                localStorage.setItem(`${fieldId}_history`, JSON.stringify(history));
                
                // Aktualizacja datalisty
                updateDatalist(fieldId, history);
            }
        }
    });
    
    alert('Protokół został zapisany w pamięci przeglądarki');
}

// Wczytanie protokołu z pamięci lokalnej
function loadProtocol() {
    const savedData = localStorage.getItem('protocolData');
    if (savedData) {
        const data = JSON.parse(savedData);
        const form = document.getElementById('protocolForm');
        
        // Wypełnienie pól tekstowych i select
        for (const key in data) {
            const field = form.elements[key];
            if (field && field.type !== 'checkbox') {
                field.value = data[key];
            }
        }
        
        // Ustawienie checkboxów
        const checkboxes = form.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = data[checkbox.name] === true || data[checkbox.name] === 'true';
        });
        
        alert('Protokół został wczytany');
    } else {
        alert('Brak zapisanego protokołu');
    }
}
```

# Część 7: Plik JavaScript (trzecia część)

```javascript
// Funkcja eksportująca dane formularza do pliku JSON
function exportToJson() {
    const form = document.getElementById('protocolForm');
    const formData = new FormData(form);
    const data = {};
    
    // Pobieranie wartości pól z formularza
    for (const [key, value] of formData.entries()) {
        data[key] = value;
    }
    
    // Pobieranie wartości checkboxów
    const checkboxes = form.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
        data[checkbox.name] = checkbox.checked;
    });
    
    // Utworzenie pliku do pobrania
    const dataStr = JSON.stringify(data, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = window.URL.createObjectURL(dataBlob);
    
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = url;
    a.download = `protokol_${data.protocol_number || 'kontroli'}.json`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
}

// Funkcja importująca dane z pliku JSON
function importFromJson(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                const form = document.getElementById('protocolForm');
                
                // Wypełnienie pól tekstowych i select
                for (const key in data) {
                    const field = form.elements[key];
                    if (field && field.type !== 'checkbox') {
                        field.value = data[key];
                    }
                }
                
                // Ustawienie checkboxów
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = data[checkbox.name] === true || data[checkbox.name] === 'true';
                });
                
                alert('Protokół został zaimportowany');
            } catch (error) {
                alert('Błąd podczas importowania pliku: ' + error.message);
            }
        };
        reader.readAsText(file);
    }
}

// Czyszczenie formularza
function clearForm() {
    if (confirm('Czy na pewno chcesz wyczyścić formularz? Wszystkie niezapisane dane zostaną utracone.')) {
        document.getElementById('protocolForm').reset();
    }
}

// Aktualizacja datalistów przy załadowaniu strony
function updateDatalistsFromHistory() {
    fieldsToTrack.forEach(fieldId => {
        const history = JSON.parse(localStorage.getItem(`${fieldId}_history`)) || [];
        updateDatalist(fieldId, history);
    });
}

// Funkcja aktualizująca datalisty
function updateDatalist(fieldId, values) {
    const datalist = document.getElementById(`${fieldId}s`); // np. "address" -> "addresses"
    if (datalist) {
        // Wyczyszczenie istniejących opcji
        datalist.innerHTML = '';
        
        // Dodanie nowych opcji
        values.forEach(value => {
            const option = document.createElement('option');
            option.value = value;
            datalist.appendChild(option);
        });
    }
}

// Inicjalizacja po załadowaniu strony
document.addEventListener('DOMContentLoaded', function() {
    updateDatalistsFromHistory();
});